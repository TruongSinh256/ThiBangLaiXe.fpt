@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div>
    <h2>Login</h2>
    <label for="loginEmail">Email:</label>
    <input type="email" id="loginEmail" required><br>
    <label for="loginPassword">Password:</label>
    <input type="password" id="loginPassword" required><br>
    <button onclick="login()">Login</button>
</div>

<script>

    function login() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const urlParams = new URLSearchParams(window.location.search);
        const questionId = urlParams.get('id');
        fetch('http://localhost:7151/api/User/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(text || 'Login failed');
                    });
                }
                return response.json();
            })
            .then(data => {
                // Save the token in localStorage
                localStorage.setItem('token', data.Token);
                localStorage.setItem('check', true);
                console.log('Token saved:', localStorage.getItem('token'));

                alert("Login successful!");

                if (email === 'admin') {
                    window.location.assign("/Home/HomeAdmin");
                } else {
                    if (localStorage.getItem('selectedAnswers')){
                        debugger
                        if(confirm("Bạn đang có bài thi dở có muốn làm tiếp không?")){
                            var id = localStorage.getItem('quizID');
                            window.location.assign("/Quiz?id=" + id); 
                            return;
                        }
                    }
                    if (questionId) {
                        window.location.assign("/Quiz?id=" + questionId);
                    } else {
                        window.location.assign("/Home");
                    }
                }
            })
            .catch(error => {
                alert("Login failed: " + error.message);
                console.error('Error:', error);
            });
    }

</script>